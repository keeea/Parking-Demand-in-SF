"0","# create space-time panel"
"0","street_parks.final <- street_parks_sf"
"0",""
"0","street_parks.final<- street_parks.final %>% "
"0","  mutate(session_start_dt = ymd_hms(session_start_dt),"
"0","         interval60 = floor_date(ymd_hms(session_start_dt), unit = ""hour""),"
"0","         week = week(interval60),"
"0","         dotw = wday(interval60, label = TRUE)) %>% "
"0","  filter(hour(session_start_dt) >= 8 & hour(session_start_dt) <=19) %>% "
"0","  filter(dotw != ""Sat"" & dotw != ""Sun"")"
"0","  "
"0","street_park_grid <-"
"0","  st_join(var_net,street_parks.final %>% dplyr::select(interval60)) %>%"
"0","  na.omit() "
"0",""
"0","park.panel <- "
"0","  expand.grid(interval60=unique(street_park_grid$interval60), "
"0","              uniqueID = unique(street_park_grid$uniqueID)) "
"0",""
"0","park.panel.count <- "
"0","  street_park_grid %>%"
"0","  st_drop_geometry() %>% "
"0","  mutate(Park_Counter = 1) %>%"
"0","  dplyr::select(Park_Counter,uniqueID,interval60) %>% "
"0","  right_join(park.panel,by=c(""uniqueID"",""interval60"")) %>% "
"0","  group_by(interval60, uniqueID) %>%"
"0","  summarize(Real_Count = sum(Park_Counter, na.rm=T)) %>%"
"0","  ungroup() %>%"
"0","  mutate(week = week(interval60),"
"0","         dotw = wday(interval60, label = TRUE),"
"0","         hour = hour(interval60)) %>% "
"0","  left_join(var_net %>%  dplyr::select(-countPark),"
"0","            by = c(""uniqueID"")) %>% "
"0","  st_sf()"
"2","`summarise()` has grouped output by 'interval60'. You can override using the `.groups` argument.
"
"0","# park.panel.mean <- "
"0","#   street_park_grid %>%"
"0","#   st_drop_geometry() %>% "
"0","#   mutate(Park_Counter = 1) %>%"
"0","#   right_join(park.panel,by=c(""uniqueID"",""interval15"")) %>% "
"0","#   group_by(interval15, uniqueID) %>%"
"0","#   summarize(Real_Count = sum(Park_Counter, na.rm=T)) %>%"
"0","#   ungroup() %>%"
"0","#   mutate(week = week(interval15),"
"0","#          dotw = wday(interval15, label = TRUE)) %>% "
"0","#   left_join(meter_net) %>%"
"0","#   left_join(var_net) %>% "
"0","#   mutate(mean = Real_Count/countMeters) %>%"
"0","#   st_sf() "
"0",""
"0","# add time lag to the panel"
"0","park.panel.lag <- "
"0","  park.panel.count %>% "
"0","  arrange(uniqueID,interval60) %>% "
"0","  group_by(uniqueID) %>% "
"0","  mutate(lagHour = dplyr::lag(Real_Count,1),"
"0","         lag2Hours = dplyr::lag(Real_Count,2),"
"0","         lag3Hours = dplyr::lag(Real_Count,3),"
"0","         lagDay = dplyr::lag(Real_Count,24)) %>%"
"0","  ungroup()"
"0",""
