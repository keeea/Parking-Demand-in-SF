"0","# create space-time panel"
"0","street_parks.final <- street_parks_sf[sample(nrow(street_parks_sf),200000),]  "
"0",""
"0","street_parks.final<- street_parks.final %>% "
"0","  mutate(session_start_dt = ymd_hms(session_start_dt)) %>% "
"0","  filter(hour(session_start_dt) >= 9 & hour(session_start_dt) <=18)"
"0",""
"0","street_parks.final <- street_parks.final %>% "
"0","  mutate(week = week(session_start_dt),"
"0","         dotw = wday(session_start_dt, label = TRUE),"
"0","         interval60 = floor_date(ymd_hms(session_start_dt), unit = ""hour""),"
"0","         interval15 = floor_date(ymd_hms(session_start_dt), unit = ""15 mins"")) %>%"
"0","  merge(meters, by=""post_id"") %>% "
"0","  dplyr::select(post_id, session_start_dt, gross_paid_amt, interval60, interval15)"
"0",""
"0","street_park_grid <-"
"0","  st_join(var_net,street_parks.final) %>%"
"0","  na.omit() "
"0",""
"0","park.panel <- "
"0","  expand.grid(interval60=unique(street_park_grid$interval60), "
"0","              uniqueID = unique(street_park_grid$uniqueID)) "
"0",""
"0","park.panel.count <- "
"0","  street_park_grid %>%"
"0","  st_drop_geometry() %>% "
"0","  mutate(Park_Counter = 1) %>%"
"0","  right_join(park.panel,by=c(""uniqueID"",""interval60"")) %>% "
"0","  group_by(interval60, uniqueID) %>%"
"0","  summarize(Real_Count = sum(Park_Counter, na.rm=T)) %>%"
"0","  ungroup() %>%"
"0","  mutate(week = week(interval60),"
"0","         dotw = wday(interval60, label = TRUE)) %>% "
"0","  left_join(var_net) %>% "
"0","  st_sf()"
"0",""
"0","# park.panel.mean <- "
"0","#   street_park_grid %>%"
"0","#   st_drop_geometry() %>% "
"0","#   mutate(Park_Counter = 1) %>%"
"0","#   right_join(park.panel,by=c(""uniqueID"",""interval15"")) %>% "
"0","#   group_by(interval15, uniqueID) %>%"
"0","#   summarize(Real_Count = sum(Park_Counter, na.rm=T)) %>%"
"0","#   ungroup() %>%"
"0","#   mutate(week = week(interval15),"
"0","#          dotw = wday(interval15, label = TRUE)) %>% "
"0","#   left_join(meter_net) %>%"
"0","#   left_join(var_net) %>% "
"0","#   mutate(mean = Real_Count/countMeters) %>%"
"0","#   st_sf() "
"0",""
"0","# add time lag to the panel"
"0","park.panel.lag <- "
"0","  park.panel.count %>% "
"0","  arrange(interval60, uniqueID) %>% "
"0","  mutate("
"0","         lagHour = dplyr::lag(Real_Count,1),"
"0","         lag2Hours = dplyr::lag(Real_Count,2),"
"0","         lag3Hours = dplyr::lag(Real_Count,3),"
"0","         lagDay = dplyr::lag(Real_Count,24)) %>%"
"0","  mutate(day = yday(interval60))"
"0",""
"0","ggplot(park.panel.lag, aes(interval60, Real_Count)) + "
"0","  geom_line() +"
"0","  scale_colour_manual(values = palette2) +"
"0","  labs(title=""On-street Car Parks per hour, SF, 2021-07-09"","
"0","       x=""Time"", y=""Number of Parking Records"")"
